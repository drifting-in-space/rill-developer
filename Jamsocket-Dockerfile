FROM rilldata/duckdb:0.3.2

WORKDIR /app
RUN mv node_modules /node_modules
RUN rm package.json package-lock.json
COPY . .
RUN mv /node_modules ./
RUN npm i -d
RUN rm -rf /root/.cache/ms-playwright
RUN npm run build

RUN build-tools/replace_package_type.sh module commonjs
RUN echo '#!/bin/bash\nnode /app/dist/cli/data-modeler-cli.js "$@"' > /app/rill && chmod +x /app/rill

RUN /app/rill init --project citibike
CMD ["/app/run.sh"]
